#!/data/data/com.termux/files/usr/bin/bash
# Run at device boot via Termux:Boot. Copy to ~/.termux/boot/ and enable Wake lock.
# Starts crond (for plan-execute 8/14/20, heartbeat every 6h) and the JARVIS stack.

export HOME=/data/data/com.termux/files/home
LOG="$HOME/jarvis-boot.log"
echo "boot started $(date)" >> "$LOG" 2>/dev/null || true

# Prevent device from sleeping during and after boot script
termux-wake-lock

# Give system a moment to be ready
sleep 5

# Start cron (plan-execute + heartbeat schedule). cronie uses -n for foreground; run in background.
(nohup crond -n >> "$HOME/crond.log" 2>&1 &) 2>/dev/null || true

# Start JARVIS in Proot (Ubuntu). Fallback: start-jarvis-pixel.sh if Proot not available.
if [ -f "$HOME/JARVIS/scripts/pixel-proot-bootstrap-and-start.sh" ]; then
  bash "$HOME/JARVIS/scripts/pixel-proot-bootstrap-and-start.sh" >> "$HOME/jarvis-boot.log" 2>&1
else
  bash "$HOME/JARVIS/scripts/start-jarvis-pixel.sh" >> "$HOME/jarvis-boot.log" 2>&1
fi
